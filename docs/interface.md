# Interfacing and Integration

This document describes the interfaces, and interchange format between the StudioML frontend and runners that process StudioML workload.

## Introduction

StudioML has two major modules.

The front end that shepherds experiments on behalf of users and packages them up to be queued to a backend runner

The runner that receieves json formatted messages from the StudioML front end across a message queue

There are other tools that StudioML offers for reporting and management of experiment artifacts that are not within the scope of this document.

## Runners

This project implements a StudioML runner, however it is not specific to StudioML.  This runner could be used to deliver and execute and python code within a virtualenv that the runner supplies.

Any standard runners can accept a standalone virtualenv with no associated container.  The go runner, this present project, has been extended to allow clients to also send work that has a Singularity container specified.

In the first case, virtualenv only, the runner implcitly trusts that any work received is trusted and is not malicous.  In this mode the runner makes not attempt to protect the integrity of the host it is deployed into.

In the second case if a container is specified it will be used to launch work and the runner will rely upon the container runtime to prevent leakage into the host.

## Queuing

## Payloads

```json
{"experiment": {"status": "waiting", "time_finished": null, "git": null, "key": "1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92", "time_last_checkpoint": 1530054414.027222, "pythonver": 2, "metric": null, "args": ["10"], "max_duration": "20m", "filename": "train_cifar10.py", "project": null, "artifacts": {"output": {"local": "/home/kmutch/.studioml/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/output", "bucket": "kmutch-rmq", "qualified": "s3://s3-us-west-2.amazonaws.com/kmutch-rmq/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/output.tar", "key": "experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/output.tar", "mutable": true, "unpack": true}, "_metrics": {"local": "/home/kmutch/.studioml/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/_metrics", "bucket": "kmutch-rmq", "qualified": "s3://s3-us-west-2.amazonaws.com/kmutch-rmq/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/_metrics.tar", "key": "experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/_metrics.tar", "mutable": true, "unpack": true}, "modeldir": {"local": "/home/kmutch/.studioml/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/modeldir", "bucket": "kmutch-rmq", "qualified": "s3://s3-us-west-2.amazonaws.com/kmutch-rmq/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/modeldir.tar", "key": "experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/modeldir.tar", "mutable": true, "unpack": true}, "workspace": {"local": "/home/kmutch/studio/examples/keras", "bucket": "kmutch-rmq", "qualified": "s3://s3-us-west-2.amazonaws.com/kmutch-rmq/blobstore/419411b17e9c851852735901a17bd6d20188cee30a0b589f1bf1ca5b487930b5.tar", "key": "blobstore/419411b17e9c851852735901a17bd6d20188cee30a0b589f1bf1ca5b487930b5.tar", "mutable": false, "unpack": true}, "tb": {"local": "/home/kmutch/.studioml/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/tb", "bucket": "kmutch-rmq", "qualified": "s3://s3-us-west-2.amazonaws.com/kmutch-rmq/experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/tb.tar", "key": "experiments/1530054412_70d7eaf4-3ce3-493a-a8f6-ffa0212a5c92/tb.tar", "mutable": true, "unpack": true}}, "info": {}, "resources_needed": {"hdd": "3gb", "gpus": 1, "ram": "2gb", "cpus": 1, "gpuMem": "4gb"}, "pythonenv": ["APScheduler==3.5.1", "argparse==1.2.1", "asn1crypto==0.24.0", "attrs==17.4.0", "autopep8==1.3.5", "awscli==1.15.4", "boto3==1.7.4", "botocore==1.10.4", "cachetools==2.0.1", "certifi==2018.4.16", "cffi==1.11.5", "chardet==3.0.4", "click==6.7", "cma==2.5.3", "colorama==0.3.7", "configparser==3.5.0", "cryptography==2.2.2", "dill==0.2.7.1", "docutils==0.14", "enum34==1.1.6", "filelock==3.0.4", "Flask==0.12.2", "funcsigs==1.0.2", "future==0.16.0", "futures==3.2.0", "google-api-python-client==1.6.6", "google-auth==1.4.1", "google-auth-httplib2==0.0.3", "google-cloud-core==0.27.1", "google-cloud-pubsub==0.28.3", "google-cloud-storage==1.5.0", "google-gax==0.15.14", "google-resumable-media==0.3.1", "googleapis-common-protos==1.5.3", "grpc-google-iam-v1==0.11.4", "grpcio==1.11.0", "h5py==2.7.1", "httplib2==0.11.3", "idna==2.6", "ipaddress==1.0.22", "itsdangerous==0.24", "Jinja2==2.10", "jmespath==0.9.3", "jwcrypto==0.4.2", "MarkupSafe==1.0", "more-itertools==4.1.0", "numpy==1.14.2", "oauth2client==3.0.0", "pika==0.11.2", "Pillow==5.1.0", "pip==9.0.3", "pluggy==0.6.0", "ply==3.8", "protobuf==3.5.2.post1", "psutil==5.4.5", "py==1.5.3", "pyasn1==0.4.2", "pyasn1-modules==0.2.1", "pycodestyle==2.4.0", "pycparser==2.18", "pycryptodome==3.6.1", "pygtail==0.8.0", "pytest==3.5.0", "Python==2.7.12", "python-dateutil==2.6.1", "python-jwt==3.0.0", "pytz==2018.4", "PyYAML==3.12", "requests==2.18.4", "requests-toolbelt==0.8.0", "rsa==3.4.2", "s3transfer==0.1.13", "setuptools==39.0.1", "setuptools-scm==2.0.0", "setuptools-scm-git-archive==1.0", "six==1.11.0", "sseclient==0.0.19", "-e git+https://github.com/SentientTechnologies/studio@685f4891764227a2e1ea5f7fc91b31dcf3557647#egg=studioml", "terminaltables==3.1.0", "timeout-decorator==0.4.0", "tzlocal==1.5.1", "uritemplate==3.0.0", "urllib3==1.22", "Werkzeug==0.14.1", "wheel==0.31.0", "wsgiref==0.1.2"], "owner": "guest", "time_added": 1530054413.134781, "time_started": null}, "config": {"experimentLifetime": "30m", "optimizer": {"visualization": true, "load_checkpoint_file": null, "cmaes_config": {"load_best_only": false, "popsize": 100, "sigma0": 0.25}, "termination_criterion": {"generation": 5, "fitness": 999, "skip_gen_timeout": 30, "skip_gen_thres": 1.0}, "result_dir": "~/Desktop/", "checkpoint_interval": 0}, "verbose": "debug", "saveWorkspaceFrequency": "3m", "database": {"type": "s3", "authentication": "none", "endpoint": "http://s3-us-west-2.amazonaws.com", "bucket": "kmutch-metadata"}, "runner": {"slack_destination": "@karl.mutch"}, "storage": {"type": "s3", "endpoint": "http://s3-us-west-2.amazonaws.com", "bucket": "kmutch-rmq"}, "server": {"authentication": "None"}, "resources_needed": {"gpus": 1, "hdd": "3gb", "ram": "2gb", "cpus": 1, "gpuMem": "4gb"}, "env": {"PATH": "%PATH%:./bin", "AWS_DEFAULT_REGION": "us-west-2", "AWS_ACCESS_KEY_ID": "AKZAIE5G7Q2GZC3OMTYW", "AWS_SECRET_ACCESS_KEY": "rt43wqJ/w5aqAPat659gkkYpphnOFxXejsCBq"}, "cloud": {"queue": {"rmq": "amqp://user:password@10.230.72.19:5672/"}}}}
```
